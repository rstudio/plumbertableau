<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Writing plumbertableau Extensions in R • plumbertableau</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Writing plumbertableau Extensions in R">
<meta property="og:description" content="plumbertableau">
<meta property="og:image" content="https://rstudio.github.io/plumbertableau/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">plumbertableau</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/r-developer-guide.html">Writing plumbertableau Extensions in R</a>
    </li>
    <li>
      <a href="../articles/tableau-developer-guide.html">Using plumbertableau Extensions in Tableau</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/plumbertableau/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="r-developer-guide_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Writing plumbertableau Extensions in R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/plumbertableau/blob/master/vignettes/r-developer-guide.Rmd"><code>vignettes/r-developer-guide.Rmd</code></a></small>
      <div class="hidden name"><code>r-developer-guide.Rmd</code></div>

    </div>

    
    
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h2>
<p>This vignette will walk you through writing plumbertableau extensions in R. plumbertableau extensions are Plumber APIs with a few additional pieces, and this vignette assumes some familiarity with Plumber (<a href="https://www.rplumber.io/" class="uri">https://www.rplumber.io/</a>). If you’re unfamiliar with Plumber, the <a href="https://www.rplumber.io/articles/quickstart.html">Quickstart guide</a> gives a good overview of that package. Throughout this guide, we’ll use the terms “web service” and “API” (application programming interface) interchangeably.</p>
<p>You can install the plumbertableau package from CRAN or GitHub.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># from CRAN</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"plumbertableau"</span><span class="op">)</span>

<span class="co"># from GitHub</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"rstudio/plumbertableau"</span><span class="op">)</span></code></pre></div>
<p>Once the package is installed, you can start a new RStudio Project with a template file from the New Project menu inside RStudio:</p>
<p><img src="files/rstudio-project.png" style="width:75.0%"></p>
<p>The package also comes with several other example extensions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plumber</span><span class="fu">::</span><span class="fu"><a href="https://www.rplumber.io/reference/plumb_api.html">available_apis</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"plumbertableau"</span><span class="op">)</span>
<span class="co">#&gt; Available Plumber APIs:</span>
<span class="co">#&gt; * plumbertableau</span>
<span class="co">#&gt;   - capitalize</span>
<span class="co">#&gt;   - loess</span>
<span class="co">#&gt;   - mounts</span>
<span class="co">#&gt;   - programmatic</span>
<span class="co">#&gt;   - stringutils</span></code></pre></div>
<p>These examples can be run and optionally viewed using <code><a href="https://www.rplumber.io/reference/plumb_api.html">plumber::plumb_api()</a></code>.</p>
</div>
<div id="capabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#capabilities" class="anchor"></a>What can plumbertableau Extensions Do?</h2>
<p>plumbertableau extensions respond to requests from Tableau. In a request, Tableau will provide an <a href="https://www.rplumber.io/articles/routing-and-input.html?q=endpoint#endpoints-1"><em>endpoint</em></a> — which roughly corresponds to an R function — and will send along one or more <em>arguments</em>, which will generally consist of data from Tableau.</p>
<p>An extension <em>must</em> return data that’s the same number of observations as the arguments it receives. It can do things like transform text, or use a model to predict Y values from a matrix of X values. A plumbertableau extension can’t, say, receive an integer representing the number of elements to sample, and return a vector of that length.</p>
</div>
<div id="an-example-with-loess-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#an-example-with-loess-regression" class="anchor"></a>An Example with Loess Regression</h2>
<p>Let’s start with some plain R code that uses the <code><a href="https://rdrr.io/r/stats/loess.html">loess()</a></code> function to fit a smooth line across some input data and plot the result.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, span <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span>
<span class="va">y_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Plot the data and prediction.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_fit</span><span class="op">)</span></code></pre></div>
<p><img src="r-developer-guide_files/figure-html/unnamed-chunk-4-1.png" width="624"></p>
</div>
<div id="anatomy" class="section level2">
<h2 class="hasAnchor">
<a href="#anatomy" class="anchor"></a>The Anatomy of a plumbertableau Extension</h2>
<p>Here’s that same model in a finished plumbertableau extension.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rplumber.io">plumber</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/plumbertableau/">plumbertableau</a></span><span class="op">)</span>

<span class="co">#* @apiTitle Loess Smoothing</span>
<span class="co">#* @apiDescription Loess smoothing for Tableau</span>

<span class="co">#* Fit a loess curve to the inputs and return the curve values</span>
<span class="co">#* @param alpha Degree of smoothing</span>
<span class="co">#* @tableauArg x:integer X values for fitting</span>
<span class="co">#* @tableauArg y:numeric Y values for fitting</span>
<span class="co">#* @tableauReturn numeric Fitted loess values</span>
<span class="co">#* @post /predict</span>
<span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>
  <span class="va">l_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, span <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">l_out</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#* @plumber</span>
<span class="va">tableau_extension</span></code></pre></div>
<p>There are a few parts to our extension which are required to make it work:</p>
<ul>
<li>
<strong>Annotations</strong>. Comments beginning with <code>#*</code> are <a href="https://www.rplumber.io/articles/annotations.html">annotations</a>, which define aspects of the API for Plumber and plumbertableau.</li>
<li>
<strong>Function definitions</strong> — Each function definition must use annotations to describe the data types for all inputs and the value it returns.</li>
<li>
<strong>The Tableau extension footer</strong> — This contains the <code>tableau_extension</code> object with the <code>@plumber</code> annotation. This does the work of modifying the Plumber router to be Tableau-compatible and is a required component of all plumbertableau extensions.</li>
</ul>
<p>The <code>@apiTitle</code> and <code>@apiDescription</code> annotations are used to describe the extension in documentation which is generated.</p>
<div id="annotating-function-definitions-for-plumbertableau" class="section level3">
<h3 class="hasAnchor">
<a href="#annotating-function-definitions-for-plumbertableau" class="anchor"></a>Annotating Function Definitions for plumbertableau</h3>
<p>Let’s look again at our un-annotated function definition.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#* Annotate me!</span>
<span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>
  <span class="va">l_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, span <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">l_out</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>It accepts three inputs: <code>x</code>, <code>y</code>, and <code>alpha</code>, fits a <code><a href="https://rdrr.io/r/stats/loess.html">loess()</a></code> model using this data, and returns the output of the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function for that model. We need to annotate the function inputs and output so that plumbertableau can translate the data correctly for Tableau and generate proper documentation for the extension.</p>
<p><strong>Data provided by Tableau</strong> is described using the <code>@tableauArg</code> annotation. These annotations require a name and a type, and can optionally contain a description: <code>#* @tableauArg Name:Type Description</code>. In our example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#* @tableauArg x:integer X values for fitting</span>
<span class="co">#* @tableauArg y:numeric Y values for fitting</span></code></pre></div>
<p>Here, <code>x:integer</code> specifies the <code>x</code> argument by name, and tells plumbertableau to expect an integer vector. The string <code>X values for fitting</code> will be used to describe this argument in the generated API documentation. If an argument is optional, this can be noted using <code><a href="https://rdrr.io/r/utils/Question.html">?</a></code> after identifying the data type.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">#* @tableauArg y:numeric? Y values for fitting</span></span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="op">**</span>Data returned to Tableau<span class="op">**</span><span class="st"> </span>is described with <span class="st">`</span><span class="dt">@tableauReturn</span><span class="st">`</span>. The syntax is similar to <span class="st">`</span><span class="dt">@tableauArg</span><span class="st">`</span>, without an argument name<span class="op">:</span><span class="st"> `</span><span class="dt">#* @tableauReturn Type Description</span><span class="st">`</span>.</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#* @tableauReturn numeric Fitted loess values</span></code></pre></div>
<p>plumbertableau will expect <code>numeric</code> data to be returned, and will describe it as <code>Fitted loess values</code> in our documentation.</p>
<p><strong>URL parameters</strong> are arguments described with Plumber’s <a href="https://www.rplumber.io/articles/annotations.html#endpoint"><code>@param</code></a> annotation. These are useful for providing fixed values that don’t use data from Tableau objects. In our example the optional <code>alpha</code> parameter lets Tableau users control the degree of smoothing used in the <code>loess</code> model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#* @param alpha Degree of smoothing</span></code></pre></div>
<p>Tableau users can now add <code>?alpha=0.5</code> to the end of the extension URL to control the degree of smoothing.</p>
<p><strong>The path</strong> to the endpoint where this function is accessed is annotated with <code>@post</code>. Tableau only supports requests using the POST method, so all our Tableau-accessible endpoints must be annotated with <code>@post</code>.</p>
</div>
<div id="data-types" class="section level3">
<h3 class="hasAnchor">
<a href="#data-types" class="anchor"></a>Data Types</h3>
<p>plumbertableau understands the following R and Tableau data types.</p>
<table class="table">
<thead><tr class="header">
<th>R type</th>
<th>Tableau type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>character</code></td>
<td>
<code>string</code>, <code>str</code>
</td>
</tr>
<tr class="even">
<td><code>logical</code></td>
<td>
<code>boolean</code>, <code>bool</code>
</td>
</tr>
<tr class="odd">
<td><code>numeric</code></td>
<td><code>real</code></td>
</tr>
<tr class="even">
<td><code>integer</code></td>
<td>
<code>integer</code>, <code>int</code>
</td>
</tr>
</tbody>
</table>
<p>In addition to these described data types, you can use the type <code>any</code> to accept any type. ### Tableau Extension Footer</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#* @plumber</span>
<span class="va">tableau_extension</span></code></pre></div>
<p>In order for a plumbertableau extension to properly respond to Tableau requests, we must put this block at the bottom of our extension. The <code>@plumber</code> annotation tells Plumber to use the <code>tableau_extension</code> object to modify the router object it uses to handle requests.</p>
<p>Behind the scenes, this object is a <a href="https://www.rplumber.io/articles/annotations.html#plumber-router-modifier">Plumber Router Modifier</a>, and is compatible with <a href="https://www.rplumber.io/articles/programmatic-usage.html">programmatic usage</a> in Plumber.</p>
</div>
</div>
<div id="testing" class="section level2">
<h2 class="hasAnchor">
<a href="#testing" class="anchor"></a>Running and Testing Extensions Locally</h2>
<p>plumbertableau uses Plumber’s ability to generate <a href="https://github.com/rstudio/swagger">Swagger</a> documentation for APIs.</p>
<p>Once you’ve written an API, it can be tested locally through the Swagger UI. To start the API, click the Run API button in RStudio, or run <code>plumber::plumb("path/to/plumber.R")$run()</code> in the R console. Once the API is running, you’ll be presented with an interface like the following:</p>
<p><img src="files/swagger.png" style="width:75.0%"></p>
<p>Click on the <code>/predict</code> endpoint to expand it. You can then click “Try it out” to modify the example request, and “Execute” to send it.</p>
<p><img src="files/swagger-predict.png" style="width:75.0%"></p>
<p>Requests from Tableau consist of a JSON object with two items<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. We can see these in the simple mock request that plumbertableau provides following Tableau’s specification.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="dt">"script"</span><span class="fu">:</span> <span class="st">"/predict"</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="dt">"data"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="dt">"_arg1"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>      <span class="dv">0</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>    <span class="dt">"_arg2"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>      <span class="dv">0</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    <span class="ot">]</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="fu">}</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li>
<code>script</code>: A string identifying an endpoint. Behind the scenes, Tableau sends all extension requests to the <code>/evaluate</code> endpoint, and plumbertableau uses this string value to correctly route the request to a the requested endpoint.</li>
<li>
<code>data</code>: An object containing arguments for the function at the endpoint. plumbertableau parses this data and passes it to the R code. Tableau does not allow explicit naming of arguments, instead naming them <code>_arg1</code>, <code>_arg2</code>, … ,<code>_argN</code>. Arguments are passed to R in the order in which they appear. In this case, <code>_arg1</code> will be passed a <code>x</code> and <code>_arg2</code> will be passed a <code>y</code> to the underlying R function.</li>
</ul>
<p>To generate a more complex example, we can use <code><a href="../reference/mock_tableau_request.html">mock_tableau_request()</a></code> to create a more full-featured request for use with Swagger. Here, we pass in a data frame with two columns, and <code><a href="../reference/mock_tableau_request.html">mock_tableau_request()</a></code> uses those columns for <code>_arg</code> and <code>_arg2</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mock_tableau_request.html">mock_tableau_request</a></span><span class="op">(</span>script <span class="op">=</span> <span class="st">"/predict"</span>, 
             data <span class="op">=</span> <span class="va">mtcars</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"mpg"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     "script": "/predict",</span>
<span class="co">#&gt;     "data": {</span>
<span class="co">#&gt;         "_arg1": [</span>
<span class="co">#&gt;             110,</span>
<span class="co">#&gt;             110,</span>
<span class="co">#&gt;             93,</span>
<span class="co">#&gt;             110,</span>
<span class="co">#&gt;             175,</span>
<span class="co">#&gt;             105,</span>
<span class="co">#&gt;             245,</span>
<span class="co">#&gt;             62,</span>
<span class="co">#&gt;             95,</span>
<span class="co">#&gt;             123,</span>
<span class="co">#&gt;             123,</span>
<span class="co">#&gt;             180,</span>
<span class="co">#&gt;             180,</span>
<span class="co">#&gt;             180,</span>
<span class="co">#&gt;             205,</span>
<span class="co">#&gt;             215,</span>
<span class="co">#&gt;             230,</span>
<span class="co">#&gt;             66,</span>
<span class="co">#&gt;             52,</span>
<span class="co">#&gt;             65,</span>
<span class="co">#&gt;             97,</span>
<span class="co">#&gt;             150,</span>
<span class="co">#&gt;             150,</span>
<span class="co">#&gt;             245,</span>
<span class="co">#&gt;             175,</span>
<span class="co">#&gt;             66,</span>
<span class="co">#&gt;             91,</span>
<span class="co">#&gt;             113,</span>
<span class="co">#&gt;             264,</span>
<span class="co">#&gt;             175,</span>
<span class="co">#&gt;             335,</span>
<span class="co">#&gt;             109</span>
<span class="co">#&gt;         ],</span>
<span class="co">#&gt;         "_arg2": [</span>
<span class="co">#&gt;             21,</span>
<span class="co">#&gt;             21,</span>
<span class="co">#&gt;             22.8,</span>
<span class="co">#&gt;             21.4,</span>
<span class="co">#&gt;             18.7,</span>
<span class="co">#&gt;             18.1,</span>
<span class="co">#&gt;             14.3,</span>
<span class="co">#&gt;             24.4,</span>
<span class="co">#&gt;             22.8,</span>
<span class="co">#&gt;             19.2,</span>
<span class="co">#&gt;             17.8,</span>
<span class="co">#&gt;             16.4,</span>
<span class="co">#&gt;             17.3,</span>
<span class="co">#&gt;             15.2,</span>
<span class="co">#&gt;             10.4,</span>
<span class="co">#&gt;             10.4,</span>
<span class="co">#&gt;             14.7,</span>
<span class="co">#&gt;             32.4,</span>
<span class="co">#&gt;             30.4,</span>
<span class="co">#&gt;             33.9,</span>
<span class="co">#&gt;             21.5,</span>
<span class="co">#&gt;             15.5,</span>
<span class="co">#&gt;             15.2,</span>
<span class="co">#&gt;             13.3,</span>
<span class="co">#&gt;             19.2,</span>
<span class="co">#&gt;             27.3,</span>
<span class="co">#&gt;             26,</span>
<span class="co">#&gt;             30.4,</span>
<span class="co">#&gt;             15.8,</span>
<span class="co">#&gt;             19.7,</span>
<span class="co">#&gt;             15,</span>
<span class="co">#&gt;             21.4</span>
<span class="co">#&gt;         ]</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; </span></code></pre></div>
<p>Note that because the running API occupies your R session, you’ll have to stop running it to use <code>mock_talbeau_request()</code>. Once you’ve generated a mock request, you can run the API again and paste the request into the Swagger documentation to test the API. The data that would be sent back to Tableau appears under “Response body”.</p>
<p>It’s also worth noting that the <code>curl</code> command used by OpenAPI to submit the request doesn’t exactly match the request sent by Tableau, since the <code>curl</code> request goes to the actual endpoint (in this case <code>/predict</code>) and requests from Tableau will go to <code>/evaluate</code> and then be routed to <code>/predict</code>. The request response will still be the same.</p>
<div id="debugging" class="section level3">
<h3 class="hasAnchor">
<a href="#debugging" class="anchor"></a>Debugging Extensions</h3>
<p>plumbertableau supports debug logging via the <a href="https://github.com/r-lib/debugme"><code>debugme</code></a> R package.</p>
<p>To turn on debug messages in R, set the <code>DEBUGME</code> environment variable to a value containing <code>plumbertableau</code> in R before the package is loaded.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>DEBUGME <span class="op">=</span> <span class="st">"plumbertableau"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/plumbertableau/">plumbertableau</a></span><span class="op">)</span></code></pre></div>
<p>Additional messages will be logged to the R console while the extension is running, with information about the contents and processing of each request the extension receives.</p>
</div>
</div>
<div id="deploying-extensions" class="section level2">
<h2 class="hasAnchor">
<a href="#deploying-extensions" class="anchor"></a>Deploying Extensions</h2>
<p>Now that we’ve written our extension, we can deploy it to RStudio Connect and use it from Tableau.</p>
<ul>
<li>To learn how to publish and manage extensions on RStudio Connect, and how to configure Tableau to work with RStudio Connect, see the <strong><a href="https://docs.rstudio.com/rsc/integration/tableau/">RStudio Connect documentation on Tableau integration</a></strong>.</li>
<li>For more information about using extensions from Tableau, see <strong><a href="tableau-developer-guide.html">Using plumbertableau Extensions in Tableau</a></strong>
</li>
</ul>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://tableau.github.io/analytics-extensions-api/docs/ae_api_ref.html#post-evaluate">Tableau Analytics Extensions API Reference</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by James Blair, Joe Cheng, Toph Allen, Bill Sager, <a href="https://www.rstudio.com"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
