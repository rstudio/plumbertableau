<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R Developer Guide for Tableau Analytics Extensions • plumbertableau</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="R Developer Guide for Tableau Analytics Extensions">
<meta property="og:description" content="plumbertableau">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">plumbertableau</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/publishing-apis.html">Publishing APIs</a>
    </li>
    <li>
      <a href="../articles/r-developer-guide.html">R Developer Guide for Tableau Analytics Extensions</a>
    </li>
    <li>
      <a href="../articles/tableau-developer-guide.html">Tableau Developer Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/plumbertableau/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="r-developer-guide_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>R Developer Guide for Tableau Analytics Extensions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/plumbertableau/blob/master/vignettes/r-developer-guide.Rmd"><code>vignettes/r-developer-guide.Rmd</code></a></small>
      <div class="hidden name"><code>r-developer-guide.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level3">
<h3 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h3>
<p>Install the R package.</p>
<p>From CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"plumbertableau"</span><span class="op">)</span></code></pre></div>
<p>From Github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"rstudio/plumbertableau"</span><span class="op">)</span></code></pre></div>
</div>
<div id="getting-started" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h3>
<p><code>plumbertableau</code>, as the name suggests, is an extension of the <a href="https://www.rplumber.io/"><code>plumber</code></a> package. If you are unfamiliar with <code>plumber</code>, the <a href="https://www.rplumber.io/articles/quickstart.html">quickstart guide</a> provides a good overview of the package. Building a Tableau Analytics Extension with <code>plumbertableau</code> is simply a matter of building a <code>plumber</code> API with a few additional pieces.</p>
</div>
<div id="extension" class="section level3">
<h3 class="hasAnchor">
<a href="#extension" class="anchor"></a>Creating an extension</h3>
<p>Let’s start with an example. Let’s say we want to fit a loess curve to a given set of data. This can be done in R with the following:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, span <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span>
<span class="va">y_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here, we can visualize the result of our smoothed fit:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_fit</span><span class="op">)</span></code></pre></div>
<p><img src="r-developer-guide_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>To turn this into a Tableau extension, we can use <code>plumber</code> annotations to define the endpoint:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rplumber.io">plumber</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/plumbertableau/">plumbertableau</a></span><span class="op">)</span>

<span class="co">#* @apiTitle Loess Smoothing</span>
<span class="co">#* @apiDescription Loess smoothing for Tableau</span>

<span class="co">#* Fit a loess curve to the inputs and return the curve values</span>
<span class="co">#* @param alpha Degree of smoothing</span>
<span class="co">#* @tableauArg x:integer X values for fitting</span>
<span class="co">#* @tableauArg y:numeric Y values for fitting</span>
<span class="co">#* @tableauReturn numeric Fitted loess values</span>
<span class="co">#* @post /predict</span>
<span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>
  <span class="va">l_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, span <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">l_out</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#* @plumber</span>
<span class="va">tableau_extension</span></code></pre></div>
</div>
<div id="development" class="section level3">
<h3 class="hasAnchor">
<a href="#development" class="anchor"></a>Development</h3>
<p>Now that we have the whole picture, let’s break down each piece.</p>
<div id="plumber-annotations" class="section level4">
<h4 class="hasAnchor">
<a href="#plumber-annotations" class="anchor"></a>Plumber annotations</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rplumber.io">plumber</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/plumbertableau/">plumbertableau</a></span><span class="op">)</span>

<span class="co">#* @apiTitle Loess Smoothing</span>
<span class="co">#* @apiDescription Loess smoothing for Tableau</span>

<span class="co">#* Fit a loess curve to the inputs and return the curve values</span>
<span class="co">#* @param alpha Degree of smoothing</span>
<span class="co">#* @tab.arg x:integer X values for fitting</span>
<span class="co">#* @tab.arg y:numeric Y values for fitting</span>
<span class="co">#* @tab.return numeric Fitted loess values</span>
<span class="co">#* @post /predict</span></code></pre></div>
<p>Here we load the relevant packages and use standard <code>plumber</code> annotations to describe the API. <code>plumbertableau</code> introduces new annotations <code>tab.arg</code> and <code>tab.return</code> that allow you to describe the expected Tableau arguments and types and the return value and type of the API.</p>
</div>
<div id="function-definition" class="section level4">
<h4 class="hasAnchor">
<a href="#function-definition" class="anchor"></a>Function definition</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>
  <span class="va">l_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, span <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">l_out</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; function(x, y, alpha = 0.75) {</span>
<span class="co">#&gt;   alpha &lt;- as.numeric(alpha)</span>
<span class="co">#&gt;   l_out &lt;- loess(y ~ x, span = alpha)</span>
<span class="co">#&gt;   predict(l_out, data.frame(x, y))</span>
<span class="co">#&gt; }</span></code></pre></div>
<p>This is the actual function definition for the endpoint. Here, the values <code>x</code> and <code>y</code> are the values described in the <code>tab.arg</code> statements. These values are automatically parsed and named from the request submitted from Tableau. <code>alpha</code> is a URL parameter we can use to adjust the level of smoothing.</p>
</div>
<div id="tableau-extension" class="section level4">
<h4 class="hasAnchor">
<a href="#tableau-extension" class="anchor"></a>Tableau extension</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#* @plumber</span>
<span class="va">tableau_extension</span></code></pre></div>
<p>In order for this API to properly respond to Tableau requests, using <code>tableau_extension</code> is required. This function handles the request from Tableau and makes sure it’s forwarded to the correct endpoint.</p>
</div>
</div>
<div id="testing" class="section level3">
<h3 class="hasAnchor">
<a href="#testing" class="anchor"></a>Testing</h3>
<p>Once the extension has been developed, it can be tested locally through the default Swagger UI. In RStudio, you can click the Run API button, or you can use <code>plumber::plumb()$run()</code> to run the API. Once the API is running, you’ll be presented with an interface like the following:</p>
<div class="figure">
<img src="files/swagger.png" style="width:75.0%" alt=""><p class="caption">Swagger UI</p>
</div>
<p>From this page, you can click on the <code>/predict</code> endpoint to expand the available options. You can then click “Try it out” to test the API.</p>
<div class="figure">
<img src="files/swagger-predict.png" style="width:75.0%" alt=""><p class="caption">Swagger Predict</p>
</div>
<p>Tableau requests contain a JSON request body that contains two objects<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. * script: In the case of <code>plumbertableau</code>, this is a string that identifies the specific endpoint being requested. * data: This object contains the data being passed from Tableau to the extension. In the case of <code>plumbertableau</code>, this data is parsed and automatically made available to the underlying function. Note that values passed from Tableau are unnamed, and instead follow the naming convention <code>_arg1</code>, <code>_arg2</code>, … ,<code>_argN</code>.</p>
<p><code>plumbertableau</code> automatically provides a simple mock request that follows the specification provided by Tableau. This initial mock request contains simple <code>script</code> and <code>data</code> values. If you’d like, you can use <code><a href="../reference/tableau_json.html">tableau_json()</a></code> to create a more full-featured request for use with Swagger:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/tableau_json.html">tableau_json</a></span><span class="op">(</span>script <span class="op">=</span> <span class="st">"/predict"</span>, 
             data <span class="op">=</span> <span class="va">mtcars</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"mpg"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; {"script":"/predict","data":{"_arg1":[110,110,93,110,175,105,245,62,95,123,123,180,180,180,205,215,230,66,52,65,97,150,150,245,175,66,91,113,264,175,335,109],"_arg2":[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4]}}</span></code></pre></div>
<p>Note that you will have to stop the running API in order to generate the mock request body in the current R session.</p>
<p>Once you’ve generated a mock request body, you can insert it into the Swagger documentation for the API to test the API.</p>
<div class="figure">
<img src="files/swagger-test.png" style="width:75.0%" alt=""><p class="caption">Swagger testing</p>
</div>
</div>
<div id="deploying" class="section level3">
<h3 class="hasAnchor">
<a href="#deploying" class="anchor"></a>Deploying</h3>
<p><code>plumbertableau</code> is designed to be used with RStudio Connect. RStudio Connect supports a variety of <a href="https://docs.rstudio.com/connect/user/publishing/">different deployment methods</a>. Once an extension is published to RStudio Connect, a few things need to be adjusted to make it easily accessible from Tableau.</p>
<ol style="list-style-type: decimal">
<li><p>Provide proper access Tableau extensions used from Tableau Server and Tableau Online are setup with a single set of shared credentials. We recommend creating a service account on RStudio Connect and using that account to manage access to extensions. For example, if the service account username is “Tableau”, you would give the “Tableau” user access to the extension after it’s been published.</p></li>
<li><p>Assign a vanity URL By default, content published to RStudio Connect is assigned a URL containing the content GUID. These urls are long and unindicative of what the actual content is. We strongly recommend assigning a vanity URL to each extension published to RStudio Connect. This allows the extension to be easily referenced from Tableau workbooks. For example, if we published the previous example extension to RStudio Connect and assigned the vanity URL <code>/loess</code>, we would refer to it from a calculated field in Tableau with <code>/loess/predict</code>.</p></li>
</ol>
<div id="compatability" class="section level4">
<h4 class="hasAnchor">
<a href="#compatability" class="anchor"></a>Compatability</h4>
<p>Tableau Analytics Extensions are only supported in RStudio Connect version 1.9+. If you publish an extension to an unsupported version of RStudio Connect, the extension will successfully publish but then you will see the following message when visiting the extension:</p>
<div class="figure">
<img src="files/warnings.png" style="width:75.0%" alt=""><p class="caption">Warning message</p>
</div>
<p>Additionally, Tableau Analytics Extensions have the following requirements on RStudio Connect: * <code>Tableau.IntegrationEnabled</code> must be <code>TRUE</code> - this is the default, but can be turned off by an RStudio Connect administrator * <code>Connect.ServerAddress</code> must be set</p>
<p>If either of these criteria are not met, a published extension will show a warning message similar to the one above.</p>
</div>
</div>
<div id="debugging" class="section level3">
<h3 class="hasAnchor">
<a href="#debugging" class="anchor"></a>Debugging</h3>
<p>Logging can be enabled for <code>plumbertableau</code> using <a href="https://github.com/r-lib/debugme"><code>debugme</code></a>. Setting the <code>DEBUGME</code> environment variable to a value containing <code>plumbertableau</code> prior to loading the package will result in additional logging to the R console. These log messages can be helpful in understanding what’s happening with each request, as well as what is contained in each request. This feature is also available for content deployed on RStudio Connect by adding the <code>DEBUGME</code> <a href="https://docs.rstudio.com/connect/user/content-settings/#content-vars">environment variable</a>. RStudio Connect administrators can enable additional logging for Tableau extensions hosted on RStudio Connect.</p>
<p>Adding <code><a href="https://rdrr.io/r/base/browser.html">browser()</a></code> statements during local development can also aid in debugging efforts.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://tableau.github.io/analytics-extensions-api/docs/ae_api_ref.html#post-evaluate">Tableau Analytics Extensions API Reference</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by James Blair,  RStudio.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
